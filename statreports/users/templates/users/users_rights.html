{% extends "modules.html" %}
{% load static %}
{% block content %}


<script src="{% static 'js/jquery.tabledit.js' %}" xmlns="http://www.w3.org/1999/html"></script>
        <script src="{% static 'js/jquery.dataTables.min.js' %}"></script>



		<link rel="stylesheet" href="{% static 'css/dataTables.bootstrap4.min.css' %}" />
        <link rel="stylesheet" href="{% static 'css/font-awesome.min.css' %}" />

        <script src="{% static 'js/dataTables.bootstrap4.min.js' %}"></script>
        <script src="{% static 'js/jquery.tabledit.min.js' %}"></script>



		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/css/bootstrap-select.css">

		<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.14.0-beta2/dist/js/bootstrap-select.js"></script>



 <div class="bd-example-snippet bd-code-snippet"><div class="bd-example">
                        <nav>
                              <div class="nav nav-tabs mb-3" id="nav-tab" role="tablist">
                                    <button class="nav-link active" id="nav-home-tab" data-bs-toggle="tab" data-bs-target="#nav-home" type="button" role="tab" aria-controls="nav-home" aria-selected="true">Права пользователей</button>
                                    <button class="nav-link" id="nav-userprofile-tab" data-bs-toggle="tab" data-bs-target="#nav-userprofile" type="button" role="tab" aria-controls="nav-userprofile" aria-selected="false">Управление профилями</button>

                                    <li class="dropdown nav-item ">
                                            <button class="dropdown nav-link" id="nav-catagories-tab2" data-bs-toggle="tab" data-bs-target="" type="button" role="tab" aria-controls="" aria-selected="false">Справочники<span class="caret"></span></button>
                                                    <ul class="dropdown-menu">
                                                        <li></li><button class="nav-link dropdown-item" id="nav-catagories-tab" data-bs-toggle="tab" data-bs-target="#nav-catagories" type="button" role="tabitem" aria-controls="nav-catagories" aria-selected="false">Справочник категорий</button>
                                                        <button class="nav-link dropdown-item" id="nav-profile-tab" data-bs-toggle="tab" data-bs-target="#nav-profile" type="button" role="tabitem" aria-controls="nav-profile" aria-selected="">Справочник профилей</button>
                                                        <button class="nav-link dropdown-item" id="nav-element-tab" data-bs-toggle="tab" data-bs-target="#nav-element" type="button" role="tabitem" aria-controls="nav-element" aria-selected="false">Справочник элементов</button>
                                                    </ul>
                                    </li>

                                  </ul>
                              </div>
                        </nav>








                <div class="tab-content" id="nav-tabContent">


                    <!-- Begin of Tab panel button 0 -->
                    <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                         <div class="flex-shrink-0 p-3 bg-white" style="width: 100%;text-align:justify">
                             <div >
                                <div class="bd-example-snippet bd-code-snippet">
                                    <div class="bd-example">
                                         <!-- Content of the panel 0 -->




                                                                <div class="modal fade" id="staticBackdropLive" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLiveLabel" aria-hidden="true">
                                                                  <div class="modal-dialog">
                                                                    <div class="modal-content">
                                                                      <div class="modal-header">
                                                                        <h1 class="modal-title fs-5" id="staticBackdropLiveLabel">Прикрепление профиля пользователю</h1>
                                                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                                      </div>

                                                                         <table style="width:100%"
                                                                                  <tr>
                                                                                       <td style="width:*%">
                                                                                          &nbsp
                                                                                       </td>

                                                                                       <td style="width:95%"><div id="message_box_userrights_save">


                                                                                    </div></td>

                                                                                       <td style="width:*%">
                                                                                          &nbsp
                                                                                       </td>

                                                                                 </tr>
                                                                          </table>



                                                                      <div class="modal-body" style="">
                                                                           <table style="width:100%"
                                                                                  <tr>
                                                                                       <td style="width:*%">
                                                                                           <label for="item_users" class="form-label">Выбор пользователя:</label>
                                                                                           <div class="" id="item_users"></div>
                                                                                       </td>

                                                                                       <td style="width:10px">&nbsp</td>

                                                                                       <td style="width:*%">
                                                                                            <label for="item_profiles" class="form-label">Выбор профиля:</label>
                                                                                            <div class="" id="item_profiles"> </div>
                                                                                       </td>

                                                                                 </tr>
                                                                          </table>

                                                                      </div>
                                                                      <div class="modal-footer">
                                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Закрыть</button>
                                                                        <button type="button" class="btn btn-primary" id="addRowuserrights_save" name="addRowuserrights_save">Сохранить</button>
                                                                      </div>
                                                                    </div>
                                                                  </div>
                                                                </div>



                                                                    <script>
                                                                    $(document).ready(function(){
                                                                        var count = 0;
                                                                        function add_input_user_field(count)
                                                                        {
                                                                            var html = '';

                                                                            html += '<select class="selectpicker form-control" id="items_users_value" data-live-search="true" title="Выберите пользователя" data-hide-disabled="true"><option value="">Выберите пользователя</option>';
                                                                            html += '{% for i,v in users_form %}<option value="{{ i }}">{{ v }}</option>{% endfor %}';
                                                                            html+='</select></td>';
                                                                            return html;
                                                                        }

                                                                        function add_input_profile_field(count)
                                                                        {
                                                                            var html = '';

                                                                            html += '<select class="selectpicker form-control" id="items_profiles_value" data-live-search="true" title="Выберите профиль" data-hide-disabled="true"><option value="">Выберите профиль</option>';
                                                                            html += '{% for i,v in profile_form %}<option value="{{ i }}">{{ v }}</option>{% endfor %}';
                                                                            html+='</select></td>';
                                                                            return html;
                                                                        }

                                                                        $('#item_users').append(add_input_user_field(0));
                                                                        $('#item_profiles').append(add_input_profile_field(0));

                                                                         $('.selectpicker').selectpicker('refresh');
                                                                    });

                                                                    </script>












                             <center><p class="display-6">Управление правами пользователей</p></center>

                                        <div id="message_box_userrights">


                                        </div>

                                                    <div class="row">
                                                      <div class="col-md-12 m-b-20">
                                                        <input type="button" value="&nbsp;&nbsp;&nbsp;Добавить&nbsp;&nbsp;&nbsp;"  type="button"  data-bs-toggle="modal" data-bs-target="#staticBackdropLive" class="btn btn-secondary pull-right" style="width:11.5%;hover:red"><br><br>
                                                      </div>
                                                    </div>



                                                   <div class="panel-body">
                                                       <div class="table-responsive">
                                                            <table id="userrights_table_edit" class="table table-hover table-bordered table-striped" style="width:100%; border:1px solid black">

                                                                <thead>
                                                                    <tr>
                                                                        <th>№</th>
                                                                        <th>Пользователь</th>
                                                                        <th>Профиль</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                       </div>
                                                   </div>


                                                            <script type="text/javascript" language="javascript" >
                                                                                   $(document).ready(function(){

                                                                                   var dataTable = $('#userrights_table_edit').DataTable({
                                                                                                            "processing" : true,
                                                                                                                                "serverSide" : true,
                                                                                                                                "order" : [],
                                                                                                                                "ajax" : {
                                                                                                                                    url:"users_rights_userrights_update",
                                                                                                                                    type:"POST",
                                                                                                                                     columns: {
                                                                                                                                identifier: [0, 'id'],
                                                                                                                                editable: [


                                                                                                                                  [1, 'userID', 'select', '{ {% for i,v in users_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                                                                                                  [2, 'profilesIndex_FK', 'select', '{ {% for i,v in profile_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                                                                                                ]
                                                                                                                              },
                                                                                                                                        data: {
                                                                                                                                                FORMSELECTOR: 'SELECTOR',
                                                                                                                                                csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                                },
                                                                                                                                          }
                                                                                                 });



                                                                                  $('#userrights_table_edit').on('draw.dt', function(){

                                                                                                        $('#userrights_table_edit').Tabledit({
                                                                                                            url: 'users_rights_userrights_update',
                                                                                                            type:"POST",
                                                                                                            dataType:'json',
                                                                                                                     columns: {
                                                    identifier: [0, 'id'],
                                                    editable: [

                                                       [1, 'userID', 'select', '{ {% for i,v in users_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                       [2, 'profilesIndex_FK', 'select', '{ {% for i,v in profile_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                    ]
                                                  },
                                                                                                                    restoreButton:false,
                                                                                                                    onSuccess:function(data, textStatus, jqXHR)
                                                                                                                    {
                                                                                                                            if(data.action == 'new' || data.action == 'edit' || data.action == 'delete')
                                                                                                                                 {
                                                                                                                                   $('#' + data.id).remove();
                                                                                                                                   $('#userrights_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_userrights_delete_item_span').length!=0) {

                                                                                                                                         $('#id_message_userrights_delete_item').remove();

                                                                                                                                   }
                                                                                                                                   $('#message_box_userrights').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_userrights_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_userrights_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_userrights_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_userrights_delete_item_span').empty()
                                                                                                                                   $('#id_message_userrights_delete_item_span').append(data.message);
                                                                                                                                 }

                                                                                                                    },

                                                                                                                    onFail:function(jqXHR, textStatus, errorThrown)
                                                                                                                    {
                                                                                                                                   $('#userrights_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_userrights_delete_item_span').length!=0) {
                                                                                                                                         $('#id_message_userrights_delete_item').remove();
                                                                                                                                   }
                                                                                                                                   $('#message_box_userrights').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_userrights_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_userrights_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_userrights_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_userrights_delete_item_span').empty()
                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {

                                                                                                                                   if(key=='message') {
                                                                                                                                   $('#id_message_userrights_delete_item_span').append('Ошибка : ' +data);
                                                                                                                                                       }
                                                                                                                                    });
                                                                                                                    }
                                                                                                        });
                                                                                  });




                                                                                 $("#addRowuserrights_save").on('click', function () {

                                                                                             if ($('#items_users_value').children("option:selected").val()>0 && $('#items_profiles_value').children("option:selected").val()>0)  {

                                                                                                }
                                                                                                else
                                                                                                {
                                                                                                                                  if ($('#id_message_userrights_save_delete_item_span').length!=0) {
                                                                                                                                         $('#id_message_userrights_save_delete_item').remove();
                                                                                                                                   }
                                                                                                                                   $('#message_box_userrights_save').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_userrights_save_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_userrights_save_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");

                                                                                                                                   $('#id_message_userrights_save_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_userrights_save_delete_item_span').empty()


                                                                                                                                   $('#id_message_userrights_save_delete_item_span').append('Ошибка : Пожалуйста выберите значения двух нижепредставленных списков!');





                                                                                                return event.preventDefault();

                                                                                                }

                                                                                                    $('#staticBackdropLive').on('hidden.bs.modal', function (e) {
                                                                                                      if ($('#id_message_userrights_save_delete_item_span').length!=0) {

                                                                                                                                         $('#id_message_userrights_save_delete_item').remove();

                                                                                                                                                                        }

                                                                                                      $('#id_message_userrights_save_delete_item_span').empty()


                                                                                                    $('#items_users_value option').prop("selected", false).trigger('change');

                                                                                                    $('#items_profiles_value option').prop("selected", false).trigger('change');

                                                                                                    $('items_users_value').selectpicker('refresh');



                                                                                                    });

                                                                                                      $.ajax({
                                                                                                                type: "POST",
                                                                                                                url: "users_rights_userrights_update",
                                                                                                                datatype: 'json',
                                                                                                                data:
                                                                                                                    {
                                                                                                                      action: 'edit',
                                                                                                                      id: 'new',
                                                                                                                      csrfmiddlewaretoken: "{{ csrf_token }}",
                                                                                                                      'userID': $('#items_users_value').children("option:selected").val(),
                                                                                                                      'profilesIndex_FK': $('#items_profiles_value').children("option:selected").val(),


                                                                                                                    },
                                                                                                                       success:function(data)
                                                                                                                    {


                                                                                                                                   $('#userrights_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_userrights_save_delete_item_span').length!=0) {

                                                                                                                                         $('#id_message_userrights_save_delete_item').remove();

                                                                                                                                   }
                                                                                                                                   $('#message_box_userrights_save').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_userrights_save_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_userrights_save_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_userrights_save_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_userrights_save_delete_item_span').empty()
                                                                                                                                   $('#id_message_userrights_save_delete_item_span').append(data.message);


                                                                                                                                    setTimeout(function () {
                                                                                                                                                $('#staticBackdropLive').modal('hide');

                                                                                                                                            }, 600);





                                                                                                                    },
                                                                                                                    error:function (jqXHR, textStatus) {


                                                                                                                                   if ($('#id_message_userrights_save_delete_item_span').length!=0) {
                                                                                                                                         $('#id_message_userrights_save_delete_item').remove();
                                                                                                                                   }
                                                                                                                                   $('#message_box_userrights_save').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_userrights_save_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_userrights_save_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");

                                                                                                                                   $('#id_message_userrights_save_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_userrights_save_delete_item_span').empty()
                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {

                                                                                                                                   if(key=='message') {

                                                                                                                                        $('#id_message_userrights_save_delete_item_span').append('Ошибка : ' +data);

                                                                                                                                                      }
                                                                                                                                    });



                                                                                                                            }


                                                                                                             })
                                                                                                    });

                                                                                 });

                                                            </script>



















                                        <!-- End of the panel button 0 -->
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                    <!-- End of Tab panel button 0 -->


                     <!-- Begin of Tab panel button 000 -->
                    <div class="tab-pane fade" id="nav-userprofile" role="tabpanel" aria-labelledby="nav-userprofile-tab">
                         <div class="flex-shrink-0 p-3 bg-white" style="width: 100%;text-align:justify">
                             <div >
                                <div class="bd-example-snippet bd-code-snippet">
                                    <div class="bd-example">
                                         <!-- Content of the panel 000 -->





                                        <center><p class="display-6">Управление профилями</p></center>
                                                <div id="message_box_profileset">

                                                </div>
                                                    <div class="row">
                                                      <div class="col-md-12 m-b-20">
                                                        <input type="button" value="&nbsp;&nbsp;&nbsp;Добавить&nbsp;&nbsp;&nbsp;" id="addRowprofileset" class="btn btn-secondary pull-right" style="width:11.5%;hover:red"><br><br>
                                                      </div>
                                                    </div>

                                                   <div class="panel-body">
                                                       <div class="table-responsive">
                                                            <table id="profileset_table_edit" class="table table-hover table-bordered table-striped" style="width:100%; border:1px solid black">
                                                                <thead>
                                                                    <tr>
                                                                        <th>№</th>
                                                                        <th>Профиль</th>
                                                                        <th>Категория</th>
                                                                        <th>Элемент категории</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                       </div>
                                                   </div>


                                                            <script type="text/javascript" language="javascript" >
                                                                                   $(document).ready(function(){

                                                                                   var dataTable = $('#profileset_table_edit').DataTable({
                                                                                                            "processing" : true,
                                                                                                                                "serverSide" : true,
                                                                                                                                "order" : [],
                                                                                                                                "ajax" : {
                                                                                                                                    url:"users_rights_profileset_update",
                                                                                                                                    type:"POST",
                                                                                                                                     columns: {
                                                                                                                                identifier: [0, 'id'],
                                                                                                                                editable: [

                                                                                                                                  [1, 'profileIndex_FK', 'select', '{ {% for i,v in profile_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                                                                                                  [2, 'categoryID_FK', 'select', '{ {% for i,v in category_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                                                                                                  [3, 'subCategoryID_FK', 'select', '{ {% for i,v in subCategory_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}']
                                                                                                                                ]
                                                                                                                              },
                                                                                                                                        data: {
                                                                                                                                                FORMSELECTOR: 'SELECTOR',
                                                                                                                                                csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                                },
                                                                                                                                          }
                                                                                                 });



                                                                                  $('#profileset_table_edit').on('draw.dt', function(){

                                                                                                        $('#profileset_table_edit').Tabledit({
                                                                                                            url: 'users_rights_profileset_update',
                                                                                                            type:"POST",
                                                                                                            dataType:'json',
                                                                                                                     columns: {
                                                    identifier: [0, 'id'],
                                                    editable: [

                                                      [1, 'profileIndex_FK', 'select', '{ {% for i,v in profile_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                      [2, 'categoryID_FK', 'select', '{ {% for i,v in category_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}'],
                                                      [3, 'subCategoryID_FK', 'select', '{ {% for i,v in subCategory_form %}"{{ i }}" : "{{ v }}"{% if not forloop.last %},{% endif %}{% endfor %}}']
                                                    ]
                                                  },
                                                                                                                    restoreButton:false,
                                                                                                                    onSuccess:function(data, textStatus, jqXHR)
                                                                                                                    {

                                                                                                                                   $('#' + data.id).remove();
                                                                                                                                   $('#profileset_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_profileset_delete_item_span').length!=0) {

                                                                                                                                         $('#id_message_profileset_delete_item').remove();

                                                                                                                                   }
                                                                                                                                   $('#message_box_profileset').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_profileset_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_profileset_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_profileset_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_profileset_delete_item_span').empty()
                                                                                                                                   $('#id_message_profileset_delete_item_span').append(data.message);

                                                                                                                    },

                                                                                                                    onFail:function(jqXHR, textStatus, errorThrown)
                                                                                                                    {
                                                                                                                                   $('#profileset_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_profileset_delete_item_span').length!=0) {
                                                                                                                                         $('#id_message_profileset_delete_item').remove();
                                                                                                                                   }
                                                                                                                                   $('#message_box_profileset').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_profileset_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_profileset_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_profileset_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_profileset_delete_item_span').empty()
                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {

                                                                                                                                   if(key=='message') {
                                                                                                                                   $('#id_message_profileset_delete_item_span').append('Ошибка : ' +data);
                                                                                                                                                       }
                                                                                                                                    });
                                                                                                                    }
                                                                                                        });
                                                                                  });
$("#addRowprofileset").click(function() {

	var tableditTableName1 = '#profileset_table_edit';  // Identifier of table
	var newID = 'new';
	var clone = $(tableditTableName1 + " tr:last").clone();
	$(".tabledit-span", clone).text("");
	$(".tabledit-input", clone).val("");
	clone.prependTo(tableditTableName1);
	$(tableditTableName1 + " tbody tr:first td .tabledit-span.tabledit-identifier").text(newID);
	$(tableditTableName1 + " tbody tr:first td .tabledit-input.tabledit-identifier").val(newID);
	$(tableditTableName1 + " tbody tr:first td:last .tabledit-edit-button").trigger("click");
});

                                                                                 $("#addRowprofileset1").on('click', function () {
                                                                                                      $.ajax({
                                                                                                                type: "POST",
                                                                                                                url: "users_rights_profileset_update",
                                                                                                                datatype: 'json',
                                                                                                                data:
                                                                                                                    {
                                                                                                                      action: 'new',
                                                                                                                      csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                    },
                                                                                                                        success: function (data)
                                                                                                                        {
                                                                                                                            $('#profileset_table_edit').DataTable().ajax.reload();
                                                                                                                          // Add 'html' data to table
                                                                                                                          //$('#profileset_table_edit tbody').html(data);

                                                                                                                          // Update Tabledit plugin
                                                                                                                         // $('#profileset_table_edit').Tabledit('update');
                                                                                                                        },
                                                                                                                            error: function () {

                                                                                                                            }
                                                                                                             })
                                                                                                    });

                                                                                 });

                                                            </script>


                                        <!-- End of the panel button 000 -->
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                    <!-- End of Tab panel button 000 -->


                       <!-- Begin of Tab panel button 1 -->
                    <div class="tab-pane fade" id="nav-catagories" role="tabpanel" aria-labelledby="nav-catagories-tab">
                         <div class="flex-shrink-0 p-3 bg-white" style="width: 100%;text-align:justify">
                            <div >
                               <div class="bd-example-snippet bd-code-snippet">
                                   <div class="bd-example">
                                         <!-- Content of the panel 1 -->






                                                        <center><p class="display-6">Редактирование справочника категорий</p></center>
                                                                <div id="message_box_categories">

                                                                </div>
                                                                    <div class="row">
                                                                      <div class="col-md-12 m-b-20">
                                                                        <input type="button" value="&nbsp;&nbsp;&nbsp;Добавить&nbsp;&nbsp;&nbsp;" id="addRowcategories" class="btn btn-secondary pull-right" style="width:11.5%;hover:red"><br><br>
                                                                      </div>
                                                                    </div>

                                                                   <div class="panel-body">
                                                                       <div class="table-responsive">
                                                                            <table id="categories_table_edit" class="table table-hover table-bordered table-striped" style="width:100%; border:1px solid black">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>№</th>
                                                                                        <th>Наименование профиля</th>
                                                                                                                                                                        </tr>
                                                                                </thead>
                                                                                <tbody></tbody>
                                                                            </table>
                                                                       </div>
                                                                   </div>


                                                                            <script type="text/javascript" language="javascript" >
                                                                                                   $(document).ready(function(){

                                                                                                   var dataTable = $('#categories_table_edit').DataTable({
                                                                                                                                                "processing" : true,
                                                                                                                                                "serverSide" : true,
                                                                                                                                                "order" : [],
                                                                                                                                                "ajax" : {
                                                                                                                                                    url:"users_rights_categories",
                                                                                                                                                    type:"POST",
                                                                                                                                                        data: {
                                                                                                                                                                FORMSELECTOR: 'SELECTOR',
                                                                                                                                                                csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                                                },
                                                                                                                                                          }
                                                                                                                 });



                                                                                                  $('#categories_table_edit').on('draw.dt', function(){

                                                                                                                        $('#categories_table_edit').Tabledit({
                                                                                                                            url: 'users_rights_categories',
                                                                                                                            type:"POST",
                                                                                                                            dataType:'json',
                                                                                                                                    columns:{
                                                                                                                                        identifier : [0, 'id'],
                                                                                                                                        editable:[[1, 'categoryTitle']]
                                                                                                                                    },
                                                                                                                                    restoreButton:false,
                                                                                                                                    onSuccess:function(data, textStatus, jqXHR)
                                                                                                                                    {
                                                                                                                                                if(data.action == 'new' || data.action == 'edit' || data.action == 'delete')
                                                                                                                                                {
                                                                                                                                                   $('#' + data.id).remove();
                                                                                                                                                   $('#categories_table_edit').DataTable().ajax.reload();
                                                                                                                                                   if ($('#id_message_categories_delete_item_span').length!=0) {

                                                                                                                                                         $('#id_message_categories_delete_item').remove();

                                                                                                                                                   }
                                                                                                                                                   $('#message_box_categories').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_categories_delete_item' hidden>"+
                                                                                                                                                                                      "<span id='id_message_categories_delete_item_span'></span>"+
                                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                                      "</div>");
                                                                                                                                                   $('#id_message_categories_delete_item').removeAttr('hidden');
                                                                                                                                                   $('#id_message_categories_delete_item_span').empty()
                                                                                                                                                   $('#id_message_categories_delete_item_span').append(data.message);
                                                                                                                                                }
                                                                                                                                    },
                                                                                                                                    onFail:function(jqXHR, textStatus, errorThrown)
                                                                                                                                    {
                                                                                                                                                   $('#categories_table_edit').DataTable().ajax.reload();
                                                                                                                                                   if ($('#id_message_categories_delete_item_span').length!=0) {
                                                                                                                                                         $('#id_message_categories_delete_item').remove();
                                                                                                                                                   }
                                                                                                                                                   $('#message_box_categories').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_categories_delete_item' hidden>"+
                                                                                                                                                                                      "<span id='id_message_categories_delete_item_span'></span>"+
                                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                                      "</div>");
                                                                                                                                                   $('#id_message_categories_delete_item').removeAttr('hidden');
                                                                                                                                                   $('#id_message_categories_delete_item_span').empty()
                                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {

                                                                                                                                                   if(key=='message') {
                                                                                                                                                   $('#id_message_categories_delete_item_span').append('Ошибка : ' +data);
                                                                                                                                                                       }
                                                                                                                                                    });
                                                                                                                                    }
                                                                                                                        });
                                                                                                  });

$("#addRowcategories").click(function() {

	var tableditTableName1 = '#categories_table_edit';  // Identifier of table
	var newID = 'new';
	var clone = $(tableditTableName1 + " tr:last").clone();
	$(".tabledit-span", clone).text("");
	$(".tabledit-input", clone).val("");
	clone.prependTo(tableditTableName1);
	$(tableditTableName1 + " tbody tr:first td .tabledit-span.tabledit-identifier").text(newID);
	$(tableditTableName1 + " tbody tr:first td .tabledit-input.tabledit-identifier").val(newID);
	$(tableditTableName1 + " tbody tr:first td:last .tabledit-edit-button").trigger("click");

});
                                                                                                 $("#addRowcategories1").on('click', function () {
                                                                                                                      $.ajax({
                                                                                                                                type: "POST",
                                                                                                                                url: "users_rights_categories",
                                                                                                                                datatype: 'json',
                                                                                                                                data:
                                                                                                                                    {
                                                                                                                                      action: 'new',
                                                                                                                                      csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                    },
                                                                                                                                        success: function (data)
                                                                                                                                        {
                                                                                                                                            $('#categories_table_edit').DataTable().ajax.reload();
                                                                                                                                          // Add 'html' data to table
                                                                                                                                          //$('#categories_table_edit tbody').html(data);

                                                                                                                                          // Update Tabledit plugin
                                                                                                                                         // $('#categories_table_edit').Tabledit('update');
                                                                                                                                        },
                                                                                                                                            error: function () {

                                                                                                                                            }
                                                                                                                             })
                                                                                                                    });

                                                                                                 });

                                                                            </script>



                                        <!-- End of the panel button 1 -->
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                    <!-- End of Tab panel button 1 -->



                    <!-- Begin of Tab panel button 2 -->
                    <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                          <div class="flex-shrink-0 p-3 bg-white" style="width: 100%;text-align:justify">
                             <div >
                                <div class="bd-example-snippet bd-code-snippet">
                                    <div class="bd-example">
                                         <!-- Content of the panel 2 -->






                                        <center><p class="display-6">Редактирование справочника профилей</p></center>
                                                                <div id="message_box_profiles">

                                                                </div>
                                                                    <div class="row">
                                                                      <div class="col-md-12 m-b-20">
                                                                        <input type="button" value="&nbsp;&nbsp;&nbsp;Добавить&nbsp;&nbsp;&nbsp;" id="addRowProfiles" class="btn btn-secondary pull-right" style="width:11.5%;hover:red"><br><br>
                                                                      </div>
                                                                    </div>

                                                                   <div class="panel-body">
                                                                       <div class="table-responsive">
                                                                            <table id="profiles_table_edit" class="table table-hover table-bordered table-striped" style="width:100%; border:1px solid black">
                                                                                <thead>
                                                                                    <tr>
                                                                                        <th>№</th>
                                                                                        <th>Наименование профиля</th>
                                                                                                                                                                        </tr>
                                                                                </thead>
                                                                                <tbody></tbody>
                                                                            </table>
                                                                       </div>
                                                                   </div>


                                                                            <script type="text/javascript" language="javascript" >
                                                                                                   $(document).ready(function(){

                                                                                                   var dataTable = $('#profiles_table_edit').DataTable({
                                                                                                                                                "processing" : true,
                                                                                                                                                "serverSide" : true,
                                                                                                                                                "order" : [],
                                                                                                                                                "ajax" : {
                                                                                                                                                    url:"users_rights_profiles",
                                                                                                                                                    type:"POST",
                                                                                                                                                        data: {
                                                                                                                                                                FORMSELECTOR: 'SELECTOR',
                                                                                                                                                                csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                                                },
                                                                                                                                                          }
                                                                                                                 });



                                                                                                  $('#profiles_table_edit').on('draw.dt', function(){

                                                                                                                        $('#profiles_table_edit').Tabledit({
                                                                                                                            url: 'users_rights_profiles',
                                                                                                                            type:"POST",
                                                                                                                            dataType:'json',
                                                                                                                                    columns:{
                                                                                                                                        identifier : [0, 'id'],
                                                                                                                                        editable:[[1, 'profileIndexTitle']]
                                                                                                                                    },
                                                                                                                                    restoreButton:false,
                                                                                                                                    onSuccess:function(data, textStatus, jqXHR)
                                                                                                                                    {
                                                                                                                                                 if(data.action == 'new' || data.action == 'edit' || data.action == 'delete')
                                                                                                                                                {
                                                                                                                                                   $('#' + data.id).remove();
                                                                                                                                                   $('#profiles_table_edit').DataTable().ajax.reload();
                                                                                                                                                   if ($('#id_message_profiles_delete_item_span').length!=0) {

                                                                                                                                                         $('#id_message_profiles_delete_item').remove();

                                                                                                                                                   }
                                                                                                                                                   $('#message_box_profiles').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_profiles_delete_item' hidden>"+
                                                                                                                                                                                      "<span id='id_message_profiles_delete_item_span'></span>"+
                                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                                      "</div>");
                                                                                                                                                   $('#id_message_profiles_delete_item').removeAttr('hidden');
                                                                                                                                                   $('#id_message_profiles_delete_item_span').empty()
                                                                                                                                                   $('#id_message_profiles_delete_item_span').append(data.message);
                                                                                                                                                }
                                                                                                                                    },
                                                                                                                                    onFail:function(jqXHR, textStatus, errorThrown)
                                                                                                                                    {
                                                                                                                                                   $('#profiles_table_edit').DataTable().ajax.reload();
                                                                                                                                                   if ($('#id_message_profiles_delete_item_span').length!=0) {
                                                                                                                                                         $('#id_message_profiles_delete_item').remove();
                                                                                                                                                   }
                                                                                                                                                   $('#message_box_profiles').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_profiles_delete_item' hidden>"+
                                                                                                                                                                                      "<span id='id_message_profiles_delete_item_span'></span>"+
                                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                                      "</div>");
                                                                                                                                                   $('#id_message_profiles_delete_item').removeAttr('hidden');
                                                                                                                                                   $('#id_message_profiles_delete_item_span').empty()
                                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {

                                                                                                                                                   if(key=='message') {
                                                                                                                                                   $('#id_message_profiles_delete_item_span').append('Ошибка : ' +data);
                                                                                                                                                                       }
                                                                                                                                                    });
                                                                                                                                    }
                                                                                                                        });
                                                                                                  });

$("#addRowProfiles").click(function() {

	var tableditTableName1 = '#profiles_table_edit';  // Identifier of table
	var newID = 'new';
	var clone = $(tableditTableName1 + " tr:last").clone();
	$(".tabledit-span", clone).text("");
	$(".tabledit-input", clone).val("");
	clone.prependTo(tableditTableName1);
	$(tableditTableName1 + " tbody tr:first td .tabledit-span.tabledit-identifier").text(newID);
	$(tableditTableName1 + " tbody tr:first td .tabledit-input.tabledit-identifier").val(newID);
	$(tableditTableName1 + " tbody tr:first td:last .tabledit-edit-button").trigger("click");

});

                                                                                                 $("#addRowProfiles2").on('click', function () {
                                                                                                                      $.ajax({
                                                                                                                                type: "POST",
                                                                                                                                url: "users_rights_profiles",
                                                                                                                                datatype: 'json',
                                                                                                                                data:
                                                                                                                                    {
                                                                                                                                      action: 'new',
                                                                                                                                      csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                    },
                                                                                                                                        success: function (data)
                                                                                                                                        {
                                                                                                                                            $('#profiles_table_edit').DataTable().ajax.reload();
                                                                                                                                          // Add 'html' data to table
                                                                                                                                          //$('#profiles_table_edit tbody').html(data);

                                                                                                                                          // Update Tabledit plugin
                                                                                                                                         // $('#profiles_table_edit').Tabledit('update');
                                                                                                                                        },
                                                                                                                                            error: function () {

                                                                                                                                            }
                                                                                                                             })
                                                                                                                    });

                                                                                                 });

                                                                            </script>




                                        <!-- End of the panel button 2 -->
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                    <!-- End of Tab panel button 2 -->






                      <!-- Begin of Tab panel button 3 -->
                    <div class="tab-pane fade" id="nav-element" role="tabpanel" aria-labelledby="nav-element-tab">
                          <div class="flex-shrink-0 p-3 bg-white" style="width: 100%;text-align:justify">
                             <div >
                                <div class="bd-example-snippet bd-code-snippet">
                                    <div class="bd-example">
                                         <!-- Content of the panel 3 -->


                                        <center><p class="display-6">Редактирование справочника элементов</p></center>
                                                <div id="message_box_elements">

                                                </div>
                                                    <div class="row">
                                                      <div class="col-md-12 m-b-20">
                                                        <input type="button" value="&nbsp;&nbsp;&nbsp;Добавить&nbsp;&nbsp;&nbsp;" id="addRowElements" class="btn btn-secondary pull-right" style="width:11.5%;hover:red"><br><br>
                                                      </div>
                                                    </div>

                                                   <div class="panel-body">
                                                       <div class="table-responsive">
                                                            <table id="elements_table_edit" class="table table-hover table-bordered table-striped" style="width:100%; border:1px solid black">
                                                                <thead>
                                                                    <tr>
                                                                        <th>№</th>
                                                                        <th>Наименование элемента</th>
                                                                        <th>Ссылка</th>
                                                                        <th>Порядковый номер в сортировке</th>
                                                                    </tr>
                                                                </thead>
                                                                <tbody></tbody>
                                                            </table>
                                                       </div>
                                                   </div>

                                                            <script type="text/javascript" language="javascript" >
                                                                                   $(document).ready(function(){

                                                                                   var dataTable = $('#elements_table_edit').DataTable({
                                                                                                            "processing" : true,
                                                                                                                                "serverSide" : true,
                                                                                                                                "order" : [],
                                                                                                                                "ajax" : {
                                                                                                                                    url:"users_rights_elements_update",
                                                                                                                                    type:"POST",
                                                                                                                                        data: {
                                                                                                                                                FORMSELECTOR: 'SELECTOR',
                                                                                                                                                csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                                                },
                                                                                                                                          }
                                                                                                 });



                                                                                  $('#elements_table_edit').on('draw.dt', function(){

                                                                                                        $('#elements_table_edit').Tabledit({
                                                                                                            url: 'users_rights_elements_update',
                                                                                                            type:"POST",
                                                                                                            dataType:'json',
                                                                                                                    columns:{
                                                                                                                        identifier : [0, 'id'],
                                                                                                                        editable:[[1, 'subCategoryTitle'], [2, 'subCategoryLink'], [3, 'subCategorySort','number']]
                                                                                                                    },
                                                                                                                    restoreButton:false,
                                                                                                                    onSuccess:function(data, textStatus, jqXHR)
                                                                                                                    {
                                                                                                                                if(data.action == 'new' || data.action == 'edit' || data.action == 'delete')
                                                                                                                                {
                                                                                                                                   $('#' + data.id).remove();
                                                                                                                                   $('#elements_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_elements_delete_item_span').length!=0) {

                                                                                                                                         $('#id_message_elements_delete_item').remove();

                                                                                                                                   }
                                                                                                                                   $('#message_box_elements').append("<div class='alert alert-success alert-dismissible fade show' role='alert' id='id_message_elements_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_elements_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_elements_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_elements_delete_item_span').empty()
                                                                                                                                   $('#id_message_elements_delete_item_span').append(data.message);
                                                                                                                                }
                                                                                                                    },
                                                                                                                    onFail:function(jqXHR, textStatus, errorThrown)
                                                                                                                    {
                                                                                                                                   $('#elements_table_edit').DataTable().ajax.reload();
                                                                                                                                   if ($('#id_message_elements_delete_item_span').length!=0) {
                                                                                                                                         $('#id_message_elements_delete_item').remove();
                                                                                                                                   }
                                                                                                                                   $('#message_box_elements').append("<div class='alert alert-danger alert-dismissible fade show' role='alert' id='id_message_elements_delete_item' hidden>"+
                                                                                                                                                                      "<span id='id_message_elements_delete_item_span'></span>"+
                                                                                                                                                                      "<button type='button' class='btn-close' data-bs-dismiss='alert' aria-label='Close'></button>"+
                                                                                                                                                                      "</div>");
                                                                                                                                   $('#id_message_elements_delete_item').removeAttr('hidden');
                                                                                                                                   $('#id_message_elements_delete_item_span').empty()
                                                                                                                                   $.each(jqXHR.responseJSON, function (key, data) {
                                                                                                                                   if(key=='message') {
                                                                                                                                   $('#id_message_elements_delete_item_span').append('Ошибка : ' +data);
                                                                                                                                                       }
                                                                                                                                   });
                                                                                                                    }
                                                                                                        });
                                                                                  });

$("#addRowElements").click(function() {

	var tableditTableName1 = '#elements_table_edit';  // Identifier of table
	var newID = 'new';
	var clone = $(tableditTableName1 + " tr:last").clone();
	$(".tabledit-span", clone).text("");
	$(".tabledit-input", clone).val("");
	clone.prependTo(tableditTableName1);
	$(tableditTableName1 + " tbody tr:first td .tabledit-span.tabledit-identifier").text(newID);
	$(tableditTableName1 + " tbody tr:first td .tabledit-input.tabledit-identifier").val(newID);
	$(tableditTableName1 + " tbody tr:first td:last .tabledit-edit-button").trigger("click");

});

                                                                                 $("#addRowElements2222").on('click', function () {
                                                                                                      $.ajax({
                                                                                                                type: "POST",
                                                                                                                url: "users_rights_elements_update",
                                                                                                                datatype: 'json',
                                                                                                                data:
                                                                                                                    {
                                                                                                                      action: 'new',
                                                                                                                      csrfmiddlewaretoken: "{{ csrf_token }}"
                                                                                                                    },
                                                                                                                        success: function (data)
                                                                                                                        {
                                                                                                                            $('#elements_table_edit').DataTable().ajax.reload();
                                                                                                                          // Add 'html' data to table
                                                                                                                          //$('#elements_table_edit tbody').html(data);

                                                                                                                          // Update Tabledit plugin
                                                                                                                         // $('#elements_table_edit').Tabledit('update');
                                                                                                                        },
                                                                                                                            error: function () {

                                                                                                                            }
                                                                                                             })
                                                                                                    });

                                                                                 });

                                                            </script>


                                        <!-- End of the panel button 3 -->
                                    </div>
                                </div>
                             </div>
                         </div>
                    </div>
                    <!-- End of Tab panel button 3 -->

                </div>
        </div>




{% endblock content%}